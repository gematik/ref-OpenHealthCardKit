name: OpenHealthCardKit
include:
  - path: IntegrationTests/project.yml
    relativePaths: false
    # Set environment variable to true if have access to the necessary gematik-internal resources
    enable: ${GEMATIK_DEVELOPMENT} # <-- do not edit this line
options:
  bundleIdPrefix: de.gematik.ti.ohcapp4ios
  deploymentTarget:
    macOS: 12.0
    iOS: 17.0
  minimumXcodeGenVersion: 2.3.0
schemes:
  AllTests_iOS:
    build:
      targets:
        ohcKitDummy_iOS: test
    test:
      language: de
      region: DE
      gatherCoverageData: true
      coverageTargets:
        - NFCDemo
      targets:
        - NFCDemoTests
        - package: Openhealthcardkit/CardReaderProviderApiTests
        - package: Openhealthcardkit/CardReaderAccessTests
        - package: Openhealthcardkit/HealthCardAccessTests
        - package: Openhealthcardkit/HealthCardControlTests
  AllTests_macOS:
    build:
      targets:
        ohcKitDummy_macOS: test
    test:
      targets:
        - package: Openhealthcardkit/CardReaderProviderApiTests
        - package: Openhealthcardkit/CardReaderAccessTests
        - package: Openhealthcardkit/HealthCardAccessTests
        - package: Openhealthcardkit/HealthCardControlTests
  AllSnapshotTests:
    build:
      targets:
        NFCDemo: all
    test:
      language: de
      region: DE
      gatherCoverageData: true
      coverageTargets:
        - NFCDemo
      targets:
        - NFCDemoTests

packages:
  Openhealthcardkit:
    path: ./
  ASN1Kit:
    url: https://github.com/gematik/ASN1Kit
    majorVersion: 1.2.0
  OpenSSL-Swift:
   url: https://github.com/gematik/OpenSSL-Swift
   majorVersion: 4.2.0
  SnapshotTesting:
    url: https://github.com/pointfreeco/swift-snapshot-testing
    majorVersion: 1.10.0
  AEXML:
    url: https://github.com/tadija/AEXML
    majorVersion: 4.6.0  
  StreamReader:
    url: https://github.com/hectr/swift-stream-reader/
    majorVersion: 0.3.0   
  Gzip:
    url: https://github.com/1024jp/GzipSwift
    majorVersion: 6.0.0
  SwiftyXMLParser:
    url: https://github.com/yahoojapan/SwiftyXMLParser
    majorVersion: 5.6.0
  Nimble:
    url: https://github.com/Quick/Nimble
    majorVersion: 12.0.0
settings:
  base:
    DEVELOPMENT_TEAM: A9FL89PFFL
    CODE_SIGN_IDENTITY: ""
    SWIFT_VERSION: 5.0
    ALWAYS_SEARCH_USER_PATHS: NO
    FRAMEWORK_SEARCH_PATHS: "$(inherited)"
    BUILD_LIBRARY_FOR_DISTRIBUTION: YES
  configs:
    Release:
      SWIFT_COMPILATION_MODE: wholemodule
    Debug:
      SWIFT_COMPILATION_MODE: incremental
targets:
  NFCDemo:
    type: application
    platform: iOS
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: ${GEM_PRODUCT_BUNDLE_IDENTIFIER}
        TARGETED_DEVICE_FAMILY: 1
        SWIFT_VERSION: $(inherited)
        ALWAYS_SEARCH_USER_PATHS: $(inherited)
        CODE_SIGN_ENTITLEMENTS: Sources/NFCDemo/Resources/NFCDemo.entitlements
    configFiles:
      Debug: Sources/NFCDemo/Resources/debug.xcconfig
      Release: Sources/NFCDemo/Resources/release.xcconfig
    sources:
      - Sources/NFCDemo
    scheme:
      testTargets:
        - NFCDemoTests
      gatherCoverageData: false
    dependencies:
      - package: Openhealthcardkit
        product: CardReaderProviderApi 
      - package: Openhealthcardkit
        product: CardReaderAccess
      - package: Openhealthcardkit
        product: NFCCardReaderProvider
      - package: Openhealthcardkit
        product: Helper
      - package: ASN1Kit
      - package: OpenSSL-Swift
      - package: Gzip
      - package: SwiftyXMLParser
      - package: Openhealthcardkit
        product: HealthCardAccess
      - package: Openhealthcardkit
        product: HealthCardControl
      - sdk: CoreNFC.framework
      - sdk: Combine.framework
      - sdk: SwiftUI.framework
  NFCDemoTests:
    type: bundle.unit-test
    platform: iOS
    info:
      path: Tests/NFCDemoTests/Resources/Info.plist
    sources:
      - path: Tests/NFCDemoTests
        excludes:
          - "**/__Snapshots__/**"
    dependencies:
      - target: NFCDemo
      - package: SnapshotTesting 
  ohcKitDummy:
    type: framework
    platform: [macOS,iOS]
    settings:
      GENERATE_INFOPLIST_FILE: YES
    sources:
      - Sources/CardReaderProviderApi/Card/CardError.swift

buildImplicitDependencies: true
